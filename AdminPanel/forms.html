
<!--
Author: W3layouts
Author URL: http://w3layouts.com
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>ADMIN | FORM</title>
    <!-- Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    
    <script>
        addEventListener("load", function () {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- //Meta Tags -->

    <!-- Style-sheets -->
    <!-- Bootstrap Css -->
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <!-- Bootstrap Css -->
    <!-- Common Css -->
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <!--// Common Css -->
    <!-- Nav Css -->
    <link rel="stylesheet" href="css/style4.css">
    <!--// Nav Css -->
    <!-- Fontawesome Css -->
    <link href="css/fontawesome-all.css" rel="stylesheet">
    <!--// Fontawesome Css -->
    <!--// Style-sheets -->

    <!--web-fonts-->
    <!-- <link href="//fonts.googleapis.com/css?family=Poiret+One" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet"> -->
    <!--//web-fonts-->
</head>
<style type="text/css">
    .cat{
        background-color: white
        color:black;
        border: 1px solid black;
        padding: 10px;
    }
</style>
<body>
 
            <!--// top-bar -->

            <!-- main-heading -->
            <h2 class="main-title-w3layouts mb-2 text-center">Forms</h2>
            <!--// main-heading -->

            <!-- Forms content -->
            <section class="forms-section">

                <div class="outer-w3-agile mt-3">
                    <h4 class="tittle-w3-agileits mb-4">Add Food Data</h4>
                    <div class="row validform">
                        <div class="col-md-4 order-md-2 mb-4 validform1" >
                            <h4 class="d-flex justify-content-between align-items-center mb-3">
                                <span class="text-muted">Food Data</span>
                                <span class="badge badge-secondary badge-pill" id="count">Loading....</span>
                            </h4>
                            <ul class="list-group mb-3" style="" id="fooditems">
                                
                            </ul>
                        </div>
                        <div class="col-md-8 order-md-1 validform2" id="formdata">
                            <h4 class="mb-3">Add Details Here</h4>
                                <div class="col-md-6 mb-3">
                                    <label for="firstName">Enter Category </label>
                                    <input type="text" class="form-control" id="catname" placeholder="Category" value="" required="" for="foodnames">
                                    <div class="invalid-feedback">
                                        Valid category name is required.
                                    </div>
                                </div>
                                <button id="createbtn"  class="cat" >Create Category</button>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="firstName">Food Name</label>
                                        <input type="text" class="form-control" id="foodName" placeholder="Food Name" value="" required="" for="foodnames">
                                        <div class="invalid-feedback">
                                            Valid food name is required.
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="lastName">Price</label>
                                        <input type="number" class="form-control" id="price" placeholder="Price" value="" required="">
                                        <div class="invalid-feedback">
                                            Valid Price is required.
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="username">Food Id</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">ID</span>
                                        </div>
                                        <input type="text" class="form-control" id="foodId" placeholder="" required="">
                                        <div class="invalid-feedback" style="width: 100%;">
                                            Food Id is required.
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="email">Select Categiry</label>
                                    <input type="text" name="" placeholder="Select" list="select" id="category">
                                    <datalist id="select">
                                       

                                    </datalist>
                                    <div class="invalid-feedback">
                                        
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="email">Upload a image
                                    </label>
                                    <input type="file" class="form-control" id="fileSubmit">
                                    <div class="invalid-feedback">
                                        Please upload an image.
                                    </div>
                                </div>
                                <progress value="0" max = "100" id="uploader" > 0%</progress>
                                <p id="message"></p>
                                <div class="mb-3">
                                    <label for="email">Description</label>
                                    <textarea type="text" class="form-control" id="description" placeholder="Write something about food" style="height: 8em;"></textarea>
                                    <div class="invalid-feedback">
                                        Please enter the description.
                                    </div>
                                </div>
                                                              
                                <hr class="mb-4">
                                <button id="uploadbtn"  class="btn btn-primary btn-lg btn-block error-w3l-btn" type="submit">Upload Data</button>
                                <button id="updatebtn"  class="btn btn-primary btn-lg btn-block error-w3l-btn" type="submit" style="display: none;">Update Data</button>
                            
                        </div>
                    </div>
                </div>
                <!--// Forms-4 -->
            </section>

            <!--// Forms content -->

            <!-- Copyright -->
            <div class="copyright-w3layouts py-xl-3 py-2 mt-xl-5 mt-4 text-center">
                <p>Â© 2018 Modernize . All Rights Reserved | Design by
                    <a href="http://w3layouts.com/"> W3layouts </a>
                </p>
            </div>
            <!--// Copyright -->
        </div>
    </div>


    <!-- Required common Js -->
    <script src='js/jquery-2.2.3.min.js'></script>
    <!-- //Required common Js -->

    <!-- Sidebar-nav Js -->

    <script>
        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
            });
        });
    </script>
    <!--// Sidebar-nav Js -->

    <!-- Validation Script -->
    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict';

            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');

                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
    <!--// Validation Script -->

    <!-- dropdown nav -->
    <script>
        $(document).ready(function () {
            $(".dropdown").hover(
                function () {
                    $('.dropdown-menu', this).stop(true, true).slideDown("fast");
                    $(this).toggleClass('open');
                },
                function () {
                    $('.dropdown-menu', this).stop(true, true).slideUp("fast");
                    $(this).toggleClass('open');
                }
            );
        });
    </script>
    <!-- //dropdown nav -->

    <!-- Js for bootstrap working-->
    <script src="js/bootstrap.min.js"></script>
    <!-- //Js for bootstrap working -->

</body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAi-mXsp9IpKUoDo4A59BbsA0TxBjNb0lw",
    authDomain: "restaurant-6e5ed.firebaseapp.com",
    databaseURL: "https://restaurant-6e5ed.firebaseio.com",
    projectId: "restaurant-6e5ed",
    storageBucket: "restaurant-6e5ed.appspot.com",
    messagingSenderId: "632447617294",
    appId: "1:632447617294:web:08206a2421c64e3d58af5f"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  let formMessage = firebase.database().ref('FoodData');
  let formMessage2 = firebase.database().ref('Category');
  formMessage.on('value',gotData,errData);
  formMessage2.on('value',addCat,errData);
  var  uploader = document.getElementById('uploader');
  fileSubmit.addEventListener('change', uploadFile);
  var keys,sc,sc2=0;

  createbtn.addEventListener('click',createCat)
  function createCat(){
    var count=0;
    var cat=document.querySelector('#catname').value;
   
    if(sc2==null){
        sc2=0;
    }
    keys=Object.keys(sc2)
    
    for(var i=0;i<keys.length;i++){
        var k=keys[i];
        if(sc2[k].Category==cat){
            count++;
            break;
        }
      
    }
    if(count==0){
        let newFormMessage2 = formMessage2.push();
        newFormMessage2.set({
            Category:cat,
            Status :"Active"
        });
        alert("Category Added Successfully")
    }else{
        alert("Category already exists")
    }



  }
  function addCat(data){
    sc2=data.val();
    keys=Object.keys(sc2)
    $('#select').empty();
    for (var i=0;i<keys.length;i++){
        var k=keys[i];
        var val=sc2[k].Category
        document.getElementById("select").innerHTML+=
        `
        <option value="`+val+`"/>

        `
    }
  }
  function gotData(data){
    sc=data.val();
    keys =Object.keys(sc);
    $('#fooditems').empty();
    for(var i=0;i<keys.length;i++){
        var k=keys[i];
        var name=sc[k].FoodName;
        var description=sc[k].Description;
        var price=sc[k].FoodPrice;
        var image=sc[k].Image;
        document.getElementById("fooditems").innerHTML+=
        `<li class="list-group-item d-flex justify-content-between lh-condensed">
            <div >
                <img src="`+image+`" width="70" >
                <h6 class="my-0">`+name+`</h6>
                <small class="text-muted">`+description+`</small>
            </div>
            <span class="text-muted">`+price+`</span>
            <i class ="fa fa-trash-alt" style="cursor:pointer;color:red" onclick=deleteData("`+k+`")></i>
            <i class ="fa fa-pencil-alt" style="cursor:pointer;color:black" onclick=updateData("`+k+`")></i>
        </li>
        `
    }
    document.getElementById("count").innerHTML=keys.length;
  }
  function errData(){
    
  }
  function updateData(key){

    var name=sc[key].FoodName;
    var description=sc[key].Description;
    var price=sc[key].FoodPrice;
    var image=sc[key].Image;
    var category=sc[key].Category;
    var id=sc[key].Id;

    $('#foodName').val(name)
    $('#foodId').val(id)
    $('#price').val(price)
    $('#category').val(category)
    $('#description').val(description)
    document.getElementById("uploadbtn").style.display="none"
    document.getElementById("updatebtn").style.display="block"
    updatebtn.addEventListener('click',function(){

        var FoodName=document.querySelector('#foodName').value;
        var FoodPrice=document.querySelector('#price').value;
        var Description=document.querySelector('#description').value;
        var Id=document.querySelector('#foodId').value;
        var Category=document.querySelector('#category').value;
        
       formMessage.child(key).update({ FoodName,Description,FoodPrice,Category,Id})  
       alert("Data Updated Successfully")
       window.location="forms.html"
    });
    

  }
  function deleteData(key){

      var url=sc[key].Image;
      var desertRef = firebase.storage().refFromURL(url);

      var answer=window.confirm("Are you sure, you want to Delete ?")
      if(answer){
        desertRef.delete().then(function() {
          firebase.database().ref("FoodData").child(key).remove();
          alert("Food Data Deleted")// File deleted successfully
        }).catch(function(error) {
          alert("Uh-oh, an error occurred! Please Try Again")
          // Uh-oh, an error occurred!
        });

      }
  }
  function uploadFile(e)
  {
  selectedFile=e.target.files[0];
  uploadbtn.addEventListener('click', pushData);
  }


  function sendData(Foodname,Price,Description,FoodId,foodcat,url){
    
    let newFormMessage = formMessage.push();

      newFormMessage.set({
      FoodName    : Foodname,
      FoodPrice   : Price,
      Description : Description,
      Id          : FoodId,
      Image       : url,
      Category    : foodcat,
      Status:"Active"
    });
    alert("Data Uploaded Successfully")
    window.location="forms.html"
  }
  function pushData(){
    var foodname=document.querySelector('#foodName').value;
    var price=document.querySelector('#price').value;
    var description=document.querySelector('#description').value;
    var foodid=document.querySelector('#foodId').value;
    var foodcat=document.querySelector('#category').value;
    
          const  storageService = firebase.storage();
          var uploadTask=storageService.ref(selectedFile.name).put(selectedFile);
          uploadTask.on('state_changed', function(snapshot){

          var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          uploader.value = percentage;

          // Observe state change events such as progress, pause, and resume
          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
          progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;

          document.getElementById("message").innerHTML = progress;
          switch (snapshot.state) {
          case firebase.storage.TaskState.PAUSED: // or 'paused'
          document.getElementById("message").innerHTML = "Upload Paused";
          console.log('Upload is paused');
          break;
          case firebase.storage.TaskState.RUNNING: // or 'running'
          document.getElementById("message").innerHTML = "File is uploading"+ " "+progress+"%";

          break;
        }
    }, function(error) {
    console.log(error);
    // Handle unsuccessful uploads
    }, function() {
    document.getElementById("message").innerHTML = "Uploaded"+ " "+progress+"%";
    // Handle successful uploads on complete
    // For instance, get the download URL: https://firebasestorage.googleapis.com/...
    uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
    console.log('File available at', downloadURL);
    urls = downloadURL;
    sendData(foodname,price,description,foodid,foodcat,urls)
 
    // $('#formdata').find('input:text').val('');
      });
    });

    
  }
</script>
</html>